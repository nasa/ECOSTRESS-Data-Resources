<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.33">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Working with ECOSTRESS Evapotranspiration Data â€“ ECOSTRESS-Data-Resources</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-ea385d0e468b0dd5ea5bf0780b1290d9.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-2a9bdf5a123b5cc383b46ed6d004b071.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="quarto-light">

<div id="quarto-search-results"></div>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#this-tutorial-demonstrates-how-to-work-with-the-ecostress-evapotranspiration-pt-jpl-daily-l3-global-70m-version-1-eco3etptjpl.001-data-product-in-python." id="toc-this-tutorial-demonstrates-how-to-work-with-the-ecostress-evapotranspiration-pt-jpl-daily-l3-global-70m-version-1-eco3etptjpl.001-data-product-in-python." class="nav-link active" data-scroll-target="#this-tutorial-demonstrates-how-to-work-with-the-ecostress-evapotranspiration-pt-jpl-daily-l3-global-70m-version-1-eco3etptjpl.001-data-product-in-python.">This tutorial demonstrates how to work with the ECOSTRESS Evapotranspiration PT-JPL Daily L3 Global 70m Version 1 (ECO3ETPTJPL.001) data product in Python.</a></li>
  <li><a href="#before-starting-this-tutorial" id="toc-before-starting-this-tutorial" class="nav-link" data-scroll-target="#before-starting-this-tutorial">Before Starting this Tutorial:</a></li>
  <li><a href="#procedures" id="toc-procedures" class="nav-link" data-scroll-target="#procedures">Procedures:</a>
  <ul class="collapse">
  <li><a href="#getting-started" id="toc-getting-started" class="nav-link" data-scroll-target="#getting-started">Getting Started:</a></li>
  <li><a href="#a.-import-packages" id="toc-a.-import-packages" class="nav-link" data-scroll-target="#a.-import-packages">1a. Import Packages</a></li>
  <li><a href="#b.-set-up-the-working-environment" id="toc-b.-set-up-the-working-environment" class="nav-link" data-scroll-target="#b.-set-up-the-working-environment">1b. Set Up the Working Environment</a></li>
  <li><a href="#c.-retrieve-files" id="toc-c.-retrieve-files" class="nav-link" data-scroll-target="#c.-retrieve-files">1c. Retrieve Files</a></li>
  <li><a href="#a.-open-an-ecostress-hdf5-file" id="toc-a.-open-an-ecostress-hdf5-file" class="nav-link" data-scroll-target="#a.-open-an-ecostress-hdf5-file">2a. Open an ECOSTRESS HDF5 File</a></li>
  <li><a href="#b.-subset-sds-layers-and-read-sds-metadata" id="toc-b.-subset-sds-layers-and-read-sds-metadata" class="nav-link" data-scroll-target="#b.-subset-sds-layers-and-read-sds-metadata">2b. Subset SDS Layers and read SDS Metadata</a></li>
  <li><a href="#a.-import-geolocation-file" id="toc-a.-import-geolocation-file" class="nav-link" data-scroll-target="#a.-import-geolocation-file">3a. Import Geolocation File</a></li>
  <li><a href="#b.-define-projection-and-output-grid" id="toc-b.-define-projection-and-output-grid" class="nav-link" data-scroll-target="#b.-define-projection-and-output-grid">3b. Define Projection and Output Grid</a></li>
  <li><a href="#c.-read-sds-metadata" id="toc-c.-read-sds-metadata" class="nav-link" data-scroll-target="#c.-read-sds-metadata">3c. Read SDS Metadata</a></li>
  <li><a href="#d.-perform-k-d-tree-resampling" id="toc-d.-perform-k-d-tree-resampling" class="nav-link" data-scroll-target="#d.-perform-k-d-tree-resampling">3d. Perform K-D Tree Resampling</a></li>
  <li><a href="#e.-basic-image-processing" id="toc-e.-basic-image-processing" class="nav-link" data-scroll-target="#e.-basic-image-processing">3e. Basic Image Processing</a></li>
  <li><a href="#a.-set-up-a-dictionary" id="toc-a.-set-up-a-dictionary" class="nav-link" data-scroll-target="#a.-set-up-a-dictionary">4a. Set Up a Dictionary</a></li>
  <li><a href="#b.-define-crs-and-export-as-geotiffs" id="toc-b.-define-crs-and-export-as-geotiffs" class="nav-link" data-scroll-target="#b.-define-crs-and-export-as-geotiffs">4b. Define CRS and Export as GeoTIFFs</a></li>
  <li><a href="#a.-loading-tables-with-pandas" id="toc-a.-loading-tables-with-pandas" class="nav-link" data-scroll-target="#a.-loading-tables-with-pandas">5a. Loading Tables with Pandas</a></li>
  <li><a href="#b.-locate-ecostress-pixel-from-latlon-coordinates" id="toc-b.-locate-ecostress-pixel-from-latlon-coordinates" class="nav-link" data-scroll-target="#b.-locate-ecostress-pixel-from-latlon-coordinates">5b. Locate ECOSTRESS Pixel from Lat/Lon Coordinates</a></li>
  <li><a href="#a.-create-a-colormap" id="toc-a.-create-a-colormap" class="nav-link" data-scroll-target="#a.-create-a-colormap">6a. Create a Colormap</a></li>
  <li><a href="#b.-calculate-local-overpass-time" id="toc-b.-calculate-local-overpass-time" class="nav-link" data-scroll-target="#b.-calculate-local-overpass-time">6b. Calculate Local Overpass Time</a></li>
  <li><a href="#c.-plot-et-data" id="toc-c.-plot-et-data" class="nav-link" data-scroll-target="#c.-plot-et-data">6c. Plot ET Data</a></li>
  <li><a href="#d.-exporting-an-image" id="toc-d.-exporting-an-image" class="nav-link" data-scroll-target="#d.-exporting-an-image">6d. Exporting an Image</a></li>
  <li><a href="#a.-calculate-distribution-of-ecostress-data" id="toc-a.-calculate-distribution-of-ecostress-data" class="nav-link" data-scroll-target="#a.-calculate-distribution-of-ecostress-data">7a. Calculate Distribution of ECOSTRESS Data</a></li>
  <li><a href="#b.-visualize-ground-observations" id="toc-b.-visualize-ground-observations" class="nav-link" data-scroll-target="#b.-visualize-ground-observations">7b. Visualize Ground Observations</a></li>
  <li><a href="#c.-combine-ecostress-and-ground-observations" id="toc-c.-combine-ecostress-and-ground-observations" class="nav-link" data-scroll-target="#c.-combine-ecostress-and-ground-observations">7c. Combine ECOSTRESS and Ground Observations</a></li>
  <li><a href="#citations" id="toc-citations" class="nav-link" data-scroll-target="#citations">Citations</a></li>
  <li><a href="#contact-info" id="toc-contact-info" class="nav-link" data-scroll-target="#contact-info">Contact Info:</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Working with ECOSTRESS Evapotranspiration Data</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="this-tutorial-demonstrates-how-to-work-with-the-ecostress-evapotranspiration-pt-jpl-daily-l3-global-70m-version-1-eco3etptjpl.001-data-product-in-python." class="level3">
<h3 class="anchored" data-anchor-id="this-tutorial-demonstrates-how-to-work-with-the-ecostress-evapotranspiration-pt-jpl-daily-l3-global-70m-version-1-eco3etptjpl.001-data-product-in-python.">This tutorial demonstrates how to work with the ECOSTRESS Evapotranspiration PT-JPL Daily L3 Global 70m Version 1 (<a href="https://doi.org/10.5067/ECOSTRESS/ECO3ETPTJPL.001">ECO3ETPTJPL.001</a>) data product in Python.</h3>
<p>The Land Processes Distributed Active Archive Center (LP DAAC) distributes the Ecosystem Spaceborne Thermal Radiometer Experiment on Space Station (<a href="https://ecostress.jpl.nasa.gov/">ECOSTRESS</a>) data products. The ECOSTRESS mission is tasked with measuring the temperature of plants to better understand how much water plants need and how they respond to stress. ECOSTRESS products are archived and distributed in the HDF5 file format as swath-based products.</p>
<p>In this tutorial, you will use Python to perform a swath to grid conversion to project the swath data on to a grid with a defined coordinate reference system (CRS), compare ECOSTRESS data with ground-based AmeriFlux flux tower observations, and export science dataset (SDS) layers as GeoTIFF files that can be loaded into a GIS and/or Remote Sensing software program. <strong><em> ### Example: Converting a swath ECO3ETPTJPL.001 HDF5 file into a GeoTIFF with a defined CRS and comparing ECOSTRESS Evapotranspiration (ET) with ground-based ET observations from an AmeriFlux flux tower location in California.<br>
#### Data Used in the Example:<br>
- Data Product: ECOSTRESS Evapotranspiration PT-JPL Daily L3 Global 70m Version 1 (<a href="https://doi.org/10.5067/ECOSTRESS/ECO3ETPTJPL.001">ECO3ETPTJPL.001</a>)<br>
- Science Dataset (SDS) layers:<br>
- ETinst<br>
- ETinstUncertainty<br>
- Data Product: ECOSTRESS Geolocation Daily L1B Global 70m Version 1 (<a href="https://doi.org/10.5067/ECOSTRESS/ECO1BGEO.001">ECO1BGEO.001</a>)<br>
- Science Dataset (SDS) layers:<br>
- Latitude<br>
- Longitude<br>
- Data Product: AmeriFlux Ground Observations for <a href="https://ameriflux.lbl.gov/sites/siteinfo/US-CZ3">Flux Tower US-CZ3</a>: Sierra Critical Zone, Sierra Transect, Sierran Mixed Conifer, P301 - Variables:<br>
- Latent Heat (W/m<span class="math inline">\(^{2}\)</span>)<br>
</em></strong><br>
# Topics Covered: 1. <strong>Getting Started</strong><br>
1a. Import Packages<br>
1b. Set Up the Working Environment<br>
1c. Retrieve Files<br>
2. <strong>Importing and Interpreting Data</strong><br>
2a. Open an ECOSTRESS HDF5 File and Read File Metadata<br>
2b. Subset SDS Layers<br>
3. <strong>Performing Swath2grid Conversion</strong><br>
3a. Import Geolocation File<br>
3b. Define Projection and Output Grid<br>
3c. Read SDS Metadata<br>
3d. Perform K-D Tree Resampling<br>
3e. Basic Image Processing<br>
4. <strong>Exporting Results</strong><br>
4a. Set Up a Dictionary<br>
4b. Define CRS and Export as GeoTIFFs<br>
5. <strong>Combining ECOSTRESS and AmeriFlux Tower Data</strong><br>
5a. Loading Tables with Pandas<br>
5b. Locate ECOSTRESS Pixel from Lat/Lon Coordinates<br>
6. <strong>Visualizing Data</strong><br>
6a. Create Colormap<br>
6b. Plot ET Data<br>
6c. Exporting an Image<br>
7. <strong>Comparing Observations</strong><br>
7a. Calculate Distribution of ECOSTRESS Data<br>
7b. Visualize Ground Observations<br>
7c. Combine ECOSTRESS and Ground Observations</p>
<hr>
</section>
<section id="before-starting-this-tutorial" class="level1">
<h1>Before Starting this Tutorial:</h1>
<section id="if-you-are-simply-looking-to-batch-processperform-the-swath2grid-conversion-for-ecostress-files-be-sure-to-check-out-the-ecostress-swath-to-grid-conversion-script." class="level4">
<h4 class="anchored" data-anchor-id="if-you-are-simply-looking-to-batch-processperform-the-swath2grid-conversion-for-ecostress-files-be-sure-to-check-out-the-ecostress-swath-to-grid-conversion-script.">If you are simply looking to batch process/perform the swath2grid conversion for ECOSTRESS files, be sure to check out the <a href="https://git.earthdata.nasa.gov/projects/LPDUR/repos/ecostress_swath2grid/browse">ECOSTRESS Swath to Grid Conversion Script</a>.</h4>
<p>NOTE: This tutorial was developed specifically for the ECOSTRESS Evapotranspiration PT-JPL Level 3, Version 1 HDF5 files and will need to be adapted to work with other ECOSTRESS products.<br>
## Dependencies:<br>
<em>Disclaimer: This tutorial has been tested on Windows and MacOS using the specifications identified below.</em><br>
+ #### Python Version 3.8<br>
+ <code>h5py</code><br>
+ <code>pyproj</code><br>
+ <code>matplotlib</code><br>
+ <code>pandas</code><br>
+ <code>pyresample</code><br>
+ <code>pandas</code><br>
+ <code>scipy</code><br>
+ <code>gdal</code><br>
+ <code>jupyter notebook</code></p>
<ul>
<li>A <a href="https://urs.earthdata.nasa.gov/">NASA Earthdata Login</a> account is required to download the data used in this tutorial. You can create an account at the link provided.<br>
</li>
<li>The <a href="http://www.gdal.org/">Geospatial Data Abstraction Library</a> (GDAL) is required.</li>
</ul>
<hr>
</section>
</section>
<section id="procedures" class="level1">
<h1>Procedures:</h1>
<section id="getting-started" class="level2">
<h2 class="anchored" data-anchor-id="getting-started">Getting Started:</h2>
<section id="this-tutorial-uses-data-from-ecostress-version-1-including-an-eco3etptjpl.001-and-accompanying-eco1bgeo.001-observation-from-august-05-2018.-you-can-download-the-files-directly-from-the-lp-daac-data-pool-at" class="level4">
<h4 class="anchored" data-anchor-id="this-tutorial-uses-data-from-ecostress-version-1-including-an-eco3etptjpl.001-and-accompanying-eco1bgeo.001-observation-from-august-05-2018.-you-can-download-the-files-directly-from-the-lp-daac-data-pool-at">1. This tutorial uses data from ECOSTRESS Version 1, including an ECO3ETPTJPL.001 (and accompanying ECO1BGEO.001) observation from August 05, 2018. You can download the files directly from the <a href="https://e4ftl01.cr.usgs.gov/ECOSTRESS/">LP DAAC Data Pool</a> at:</h4>
<ul>
<li><p><a href="https://e4ftl01.cr.usgs.gov/ECOSTRESS/ECO1BGEO.001/2018.08.05/ECOSTRESS_L1B_GEO_00468_007_20180805T220314_0601_03.h5">ECOSTRESS_L1B_GEO_00468_007_20180805T220314_0601_03.h5</a><br>
</p></li>
<li><p><a href="https://e4ftl01.cr.usgs.gov/ECOSTRESS/ECO3ETPTJPL.001/2018.08.05/ECOSTRESS_L3_ET_PT-JPL_00468_007_20180805T220314_0601_04.h5">ECOSTRESS_L3_ET_PT-JPL_00468_007_20180805T220314_0601_04.h5</a><br>
<strong>A <a href="https://urs.earthdata.nasa.gov/">NASA Earthdata Login</a> account is required to download the data used in this tutorial. You can create an account at the link provided.</strong></p></li>
<li><p>Ancillary Files Needed:</p>
<ul>
<li>The AmeriFlux Latent Heat data used in Section 4 can be downloaded via a <a href="https://git.earthdata.nasa.gov/projects/LPDUR/repos/tutorial-ecostress/raw/tower_data.csv?at=refs%2Fheads%2Fmain">csv file</a>.</li>
</ul></li>
</ul>
The <code>tower_data.csv</code> file will need to be downloaded into the same directory as the tutorial in order to execute the tutorial.<br>
#### 2. Copy/clone/download the <a href="https://git.earthdata.nasa.gov/rest/api/latest/projects/LPDUR/repos/tutorial-ecostress/archive?format=zip">ECOSTRESS Tutorial repo</a>, or the desired tutorial from the LP DAAC Data User Resources Repository:<br>
- <a href="https://git.earthdata.nasa.gov/projects/LPDUR/repos/tutorial-ecostress/browse/ECOSTRESS_Tutorial.ipynb">Working with ECOSTRESS Evapotranspiration Data in Python Jupyter Notebook</a><br>

<div class="alert alert-block alert-warning">
<b>NOTE:</b> This tutorial was developed specifically for the ECOSTRESS Evapotranspiration PT-JPL Level 3, Version 1 HDF5 files and will need to be adapted to work with other ECOSTRESS products.
</div>
<hr>
<h1>
<center>
<ol type="1">
<li>Getting Started
</li></ol></center>
</h1>

<hr>
</section>
</section>
<section id="a.-import-packages" class="level2">
<h2 class="anchored" data-anchor-id="a.-import-packages">1a. Import Packages</h2>
<section id="import-the-python-packages-required-to-complete-this-tutorial." class="level4">
<h4 class="anchored" data-anchor-id="import-the-python-packages-required-to-complete-this-tutorial.">Import the python packages required to complete this tutorial.</h4>
<div id="cell-3" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import packages</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> h5py</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> os.path <span class="im">import</span> join</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pyproj</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> datetime</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dateutil <span class="im">import</span> parser</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.colors <span class="im">import</span> LinearSegmentedColormap</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyresample <span class="im">import</span> geometry <span class="im">as</span> geom</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyresample <span class="im">import</span> kd_tree <span class="im">as</span> kdt</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> osgeo <span class="im">import</span> gdal, gdal_array, gdalconst, osr</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Set plots inside of the Jupyter Notebook</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
</section>
<section id="b.-set-up-the-working-environment" class="level2">
<h2 class="anchored" data-anchor-id="b.-set-up-the-working-environment">1b. Set Up the Working Environment</h2>
<section id="the-input-directory-is-defined-as-the-current-working-directory.-note-that-you-will-need-to-have-the-jupyter-notebook-and-example-data-.h5-and-.csv-stored-in-this-directory-in-order-to-execute-the-tutorial-successfully." class="level4">
<h4 class="anchored" data-anchor-id="the-input-directory-is-defined-as-the-current-working-directory.-note-that-you-will-need-to-have-the-jupyter-notebook-and-example-data-.h5-and-.csv-stored-in-this-directory-in-order-to-execute-the-tutorial-successfully.">The input directory is defined as the current working directory. Note that you will need to have the jupyter notebook and example data (.h5 and .csv) stored in this directory in order to execute the tutorial successfully.</h4>
<div id="cell-5" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Current working directory will be set as the input directory</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>inDir <span class="op">=</span>  <span class="st">"../data"</span> <span class="co">#os.getcwd() + os.sep                                                     </span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"input directory:</span><span class="ch">\n</span><span class="sc">{}</span><span class="st">"</span>.<span class="bu">format</span>(inDir))</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Set output directory</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>outDir <span class="op">=</span> os.path.normpath(os.path.split(inDir)[<span class="dv">0</span>] <span class="op">+</span> os.sep <span class="op">+</span> <span class="st">'output'</span>) <span class="op">+</span> os.sep  </span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"output directory:</span><span class="ch">\n</span><span class="sc">{}</span><span class="st">"</span>.<span class="bu">format</span>(outDir))</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Create output directory</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> os.path.exists(outDir): </span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    os.makedirs(outDir)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>input directory:
../data
output directory:
..\output\</code></pre>
</div>
</div>
</section>
<section id="make-sure-that-the-ecostress-.h5-data-files-and-ameriflux-et-data-file-.csv-are-located-in-the-input-directory-printed-above." class="level4">
<h4 class="anchored" data-anchor-id="make-sure-that-the-ecostress-.h5-data-files-and-ameriflux-et-data-file-.csv-are-located-in-the-input-directory-printed-above.">Make sure that the ECOSTRESS .h5 data files, and Ameriflux ET data file (.csv) are located in the input directory printed above.</h4>
<hr>
</section>
</section>
<section id="c.-retrieve-files" class="level2">
<h2 class="anchored" data-anchor-id="c.-retrieve-files">1c. Retrieve Files</h2>
<section id="make-sure-that-the-eco1bgeo-and-eco3etptjpl-.h5-files-listed-in-the-directions-have-been-downloaded-to-the-indir-defined-above-to-follow-along-in-the-tutorial." class="level4">
<h4 class="anchored" data-anchor-id="make-sure-that-the-eco1bgeo-and-eco3etptjpl-.h5-files-listed-in-the-directions-have-been-downloaded-to-the-indir-defined-above-to-follow-along-in-the-tutorial.">Make sure that the ECO1BGEO and ECO3ETPTJPL .h5 files listed in the directions have been downloaded to the <code>inDir</code> defined above to follow along in the tutorial.</h4>
<div id="cell-8" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>os.chdir(inDir)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-9" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># List directory contents and create lists of ECOSTRESS HDF5 files (GEO, ET)</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>geoList <span class="op">=</span> [<span class="bu">file</span> <span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> os.listdir() <span class="cf">if</span> <span class="bu">file</span>.endswith(<span class="st">'.h5'</span>) <span class="kw">and</span> <span class="st">'GEO'</span> <span class="kw">in</span> <span class="bu">file</span>]</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"geolocation:</span><span class="ch">\n</span><span class="sc">{}</span><span class="st">"</span>.<span class="bu">format</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>.join(geoList)))</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>ecoList <span class="op">=</span> [<span class="bu">file</span> <span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> os.listdir() <span class="cf">if</span> <span class="bu">file</span>.endswith(<span class="st">'.h5'</span>) <span class="kw">and</span> <span class="st">'GEO'</span> <span class="kw">not</span> <span class="kw">in</span> <span class="bu">file</span>]</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"products:</span><span class="ch">\n</span><span class="sc">{}</span><span class="st">"</span>.<span class="bu">format</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>.join(ecoList)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>geolocation:
ECOSTRESS_L1B_GEO_00468_007_20180805T220314_0601_03.h5
products:
ECOSTRESS_L3_ET_PT-JPL_00468_007_20180805T220314_0601_04.h5</code></pre>
</div>
</div>
</section>
<section id="the-standard-format-for-ecostress-filenames-is-as-follows" class="level4">
<h4 class="anchored" data-anchor-id="the-standard-format-for-ecostress-filenames-is-as-follows">The standard format for ECOSTRESS filenames is as follows:</h4>
<blockquote class="blockquote">
<p><strong>ECOSTRESS_L3_ET_PT-JPL</strong>: Product Type<br>
<strong>00468</strong>: Orbit number; starting at start of mission, ascending equatorial crossing<br>
<strong>007</strong>: Scene ID; starting at first scene of first orbit<br>
<strong>20180805T220314</strong>: Date and time of data start: YYYYMMDDThhmmss<br>
<strong>0601</strong>: Build ID of software that generated product, Major+Minor (2+2 digits)<br>
<strong>04</strong>: Product version number (2 digits)</p>
</blockquote>
<hr>
<h1>
<center>
<ol start="2" type="1">
<li>Importing and Interpreting Data
</li></ol></center>
</h1>

<hr>
</section>
</section>
<section id="a.-open-an-ecostress-hdf5-file" class="level2">
<h2 class="anchored" data-anchor-id="a.-open-an-ecostress-hdf5-file">2a. Open an ECOSTRESS HDF5 File</h2>
<section id="read-in-an-ecostress-hdf5-file-using-the-h5py-package." class="level4">
<h4 class="anchored" data-anchor-id="read-in-an-ecostress-hdf5-file-using-the-h5py-package.">Read in an ECOSTRESS HDF5 file using the <code>h5py</code> package.</h4>
<div id="cell-12" class="cell" data-scrolled="true" data-execution_count="16">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> h5py.File(ecoList[<span class="dv">0</span>])             <span class="co"># Read in ECOSTRESS HDF5 file</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>ecoName <span class="op">=</span> ecoList[<span class="dv">0</span>].split(<span class="st">'.h5'</span>)[<span class="dv">0</span>]  <span class="co"># Keep original filename</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ecoName)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ECOSTRESS_L3_ET_PT-JPL_00468_007_20180805T220314_0601_04</code></pre>
</div>
</div>
<hr>
</section>
</section>
<section id="b.-subset-sds-layers-and-read-sds-metadata" class="level2">
<h2 class="anchored" data-anchor-id="b.-subset-sds-layers-and-read-sds-metadata">2b. Subset SDS Layers and read SDS Metadata</h2>
<section id="identify-and-generate-a-list-of-all-the-sds-layers-in-the-hdf5-file." class="level4">
<h4 class="anchored" data-anchor-id="identify-and-generate-a-list-of-all-the-sds-layers-in-the-hdf5-file.">Identify and generate a list of all the SDS layers in the HDF5 file.</h4>
<div id="cell-14" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a list of all SDS inside of the .h5 file</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>eco_objs <span class="op">=</span> []</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>f.visit(eco_objs.append)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>ecoSDS <span class="op">=</span> [<span class="bu">str</span>(obj) <span class="cf">for</span> obj <span class="kw">in</span> eco_objs <span class="cf">if</span> <span class="bu">isinstance</span>(f[obj], h5py.Dataset)] </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> dataset <span class="kw">in</span> ecoSDS[<span class="dv">0</span>:<span class="dv">10</span>]: </span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(dataset)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>EVAPOTRANSPIRATION PT-JPL/ETcanopy
EVAPOTRANSPIRATION PT-JPL/ETdaily
EVAPOTRANSPIRATION PT-JPL/ETinst
EVAPOTRANSPIRATION PT-JPL/ETinstUncertainty
EVAPOTRANSPIRATION PT-JPL/ETinterception
EVAPOTRANSPIRATION PT-JPL/ETsoil
L3_ET_PT-JPL Metadata/AncillaryFileAerosolOpticalDepth
L3_ET_PT-JPL Metadata/AncillaryFileAirTemperatureNWP
L3_ET_PT-JPL Metadata/AncillaryFileAirTemperatureRS
L3_ET_PT-JPL Metadata/AncillaryFileAlbedo</code></pre>
</div>
</div>
</section>
<section id="below-subset-the-sds-list-to-the-two-layers-needed-for-comparison-with-the-ground-based-ameriflux-data-etinst-and-etinstuncertainty." class="level4">
<h4 class="anchored" data-anchor-id="below-subset-the-sds-list-to-the-two-layers-needed-for-comparison-with-the-ground-based-ameriflux-data-etinst-and-etinstuncertainty.">Below, subset the SDS list to the two layers needed for comparison with the ground-based AmeriFlux data, <code>ETinst</code> and <code>ETinstUncertainty</code>.</h4>
<div id="cell-16" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset list to ETinst and ETinstUncertainty</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>sds <span class="op">=</span> [<span class="st">'ETinst'</span>, <span class="st">'ETinstUncertainty'</span>]</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>ecoSDS <span class="op">=</span> [dataset <span class="cf">for</span> dataset <span class="kw">in</span> ecoSDS <span class="cf">if</span> dataset.endswith(<span class="bu">tuple</span>(sds))]</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> dataset <span class="kw">in</span> ecoSDS:</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(dataset.split(<span class="st">'/'</span>)[<span class="op">-</span><span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ETinst
ETinstUncertainty</code></pre>
</div>
</div>
<hr>
<h1>
<center>
<ol start="3" type="1">
<li>Performing Swath2grid Conversion
</li></ol></center>
</h1>

</section>
<section id="resample-the-native-ecostress-swath-data-to-a-grid-with-defined-coordinate-reference-system-crs." class="level4">
<h4 class="anchored" data-anchor-id="resample-the-native-ecostress-swath-data-to-a-grid-with-defined-coordinate-reference-system-crs.">Resample the native ECOSTRESS swath data to a grid with defined coordinate reference system (CRS).</h4>
<hr>
</section>
</section>
<section id="a.-import-geolocation-file" class="level2">
<h2 class="anchored" data-anchor-id="a.-import-geolocation-file">3a. Import Geolocation File</h2>
<section id="the-latitude-and-longitude-arrays-from-the-eco1bgeo-product-for-the-same-ecostress-orbitscene-id-are-needed-to-perform-the-swath2grid-conversion-on-the-eco3etpt-jpl-file." class="level4">
<h4 class="anchored" data-anchor-id="the-latitude-and-longitude-arrays-from-the-eco1bgeo-product-for-the-same-ecostress-orbitscene-id-are-needed-to-perform-the-swath2grid-conversion-on-the-eco3etpt-jpl-file.">The <code>latitude</code> and <code>longitude</code> arrays from the ECO1BGEO product for the same ECOSTRESS orbit/scene ID are needed to perform the swath2grid conversion on the ECO3ETPT-JPL file.</h4>
<div id="cell-18" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the matching ECO1BGEO file from the file list</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>geo <span class="op">=</span> [geoFile <span class="cf">for</span> geoFile <span class="kw">in</span> geoList <span class="cf">if</span> ecoList[<span class="dv">0</span>].split(<span class="st">'ECOSTRESS_L3_ET_PT-JPL_'</span>)[<span class="op">-</span><span class="dv">1</span>].split(<span class="st">'T'</span>)[<span class="dv">0</span>] <span class="kw">in</span> geoFile]</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(geo[<span class="dv">0</span>])</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ecoList[<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ECOSTRESS_L1B_GEO_00468_007_20180805T220314_0601_03.h5
ECOSTRESS_L3_ET_PT-JPL_00468_007_20180805T220314_0601_04.h5</code></pre>
</div>
</div>
</section>
<section id="read-in-the-eco1bgeo-file-search-for-the-latitude-and-longitude-sds-and-import-into-python-as-arrays." class="level4">
<h4 class="anchored" data-anchor-id="read-in-the-eco1bgeo-file-search-for-the-latitude-and-longitude-sds-and-import-into-python-as-arrays.">Read in the ECO1BGEO file, search for the <code>latitude</code> and <code>longitude</code> SDS, and import into Python as arrays.</h4>
<div id="cell-20" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Open Geo File</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>g <span class="op">=</span> h5py.File(geo[<span class="dv">0</span>])</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>geo_objs <span class="op">=</span> []</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>g.visit(geo_objs.append)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Search for lat/lon SDS inside data file</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>latSD <span class="op">=</span> [<span class="bu">str</span>(obj) <span class="cf">for</span> obj <span class="kw">in</span> geo_objs <span class="cf">if</span> <span class="bu">isinstance</span>(g[obj], h5py.Dataset) <span class="kw">and</span> <span class="st">'/latitude'</span> <span class="kw">in</span> obj]</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>lonSD <span class="op">=</span> [<span class="bu">str</span>(obj) <span class="cf">for</span> obj <span class="kw">in</span> geo_objs <span class="cf">if</span> <span class="bu">isinstance</span>(g[obj], h5py.Dataset) <span class="kw">and</span> <span class="st">'/longitude'</span> <span class="kw">in</span> obj]</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Open SDS as arrays</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>lat <span class="op">=</span> g[latSD[<span class="dv">0</span>]][()].astype(<span class="bu">float</span>)</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>lon <span class="op">=</span> g[lonSD[<span class="dv">0</span>]][()].astype(<span class="bu">float</span>)</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Read the array dimensions</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>dims <span class="op">=</span> lat.shape</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dims)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(5632, 5400)</code></pre>
</div>
</div>
<hr>
</section>
</section>
<section id="b.-define-projection-and-output-grid" class="level2">
<h2 class="anchored" data-anchor-id="b.-define-projection-and-output-grid">3b. Define Projection and Output Grid</h2>
<section id="the-latitude-and-longitude-arrays-from-the-eco1bgeo-product-for-the-same-ecostress-orbitscene-id-are-needed-to-perform-the-swath2grid-conversion-on-the-eco3etpt-jpl-file.-1" class="level4">
<h4 class="anchored" data-anchor-id="the-latitude-and-longitude-arrays-from-the-eco1bgeo-product-for-the-same-ecostress-orbitscene-id-are-needed-to-perform-the-swath2grid-conversion-on-the-eco3etpt-jpl-file.-1">The <code>latitude</code> and <code>longitude</code> arrays from the ECO1BGEO product for the same ECOSTRESS orbit/scene ID are needed to perform the swath2grid conversion on the ECO3ETPT-JPL file.</h4>
</section>
<section id="the-following-sections-use-the-pyresample-package-to-resample-the-ecostress-swath-dataset-to-a-grid-using-nearest-neighbor-method.-this-process-begins-by-defining-the-swath-dimensions-using-the-latlon-arrays-below." class="level4">
<h4 class="anchored" data-anchor-id="the-following-sections-use-the-pyresample-package-to-resample-the-ecostress-swath-dataset-to-a-grid-using-nearest-neighbor-method.-this-process-begins-by-defining-the-swath-dimensions-using-the-latlon-arrays-below.">The following sections use the <a href="https://pyresample.readthedocs.io/en/stable/">pyresample package</a> to resample the ECOSTRESS swath dataset to a grid using nearest neighbor method. This process begins by defining the swath dimensions using the lat/lon arrays below.</h4>
<div id="cell-22" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set swath definition from lat/lon arrays</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>swathDef <span class="op">=</span> geom.SwathDefinition(lons<span class="op">=</span>lon, lats<span class="op">=</span>lat)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>swathDef.corners</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<pre><code>[(-118.7239829569036, 34.221086430090274),
 (-121.86703190925778, 36.84456587689783),
 (-118.81973784761588, 39.05327678830593),
 (-115.71697211227038, 36.35603480980171)]</code></pre>
</div>
</div>
</section>
<section id="define-the-coordinates-in-the-middle-of-the-swath-which-are-used-to-calculate-an-estimate-of-the-output-rowscolumns-for-the-gridded-output." class="level4">
<h4 class="anchored" data-anchor-id="define-the-coordinates-in-the-middle-of-the-swath-which-are-used-to-calculate-an-estimate-of-the-output-rowscolumns-for-the-gridded-output.">Define the coordinates in the middle of the swath, which are used to calculate an estimate of the output rows/columns for the gridded output.</h4>
<div id="cell-24" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the lat/lon for the middle of the swath</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>mid <span class="op">=</span> [<span class="bu">int</span>(lat.shape[<span class="dv">1</span>] <span class="op">/</span> <span class="dv">2</span>) <span class="op">-</span> <span class="dv">1</span>, <span class="bu">int</span>(lat.shape[<span class="dv">0</span>] <span class="op">/</span> <span class="dv">2</span>) <span class="op">-</span> <span class="dv">1</span>]</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>midLat, midLon <span class="op">=</span> lat[mid[<span class="dv">0</span>]][mid[<span class="dv">1</span>]], lon[mid[<span class="dv">0</span>]][mid[<span class="dv">1</span>]]</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>midLat, midLon</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<pre><code>(np.float64(36.63127602811011), np.float64(-118.88736212064671))</code></pre>
</div>
</div>
</section>
<section id="below-pyproj.proj-is-used-to-perform-a-cartographic-transformation-by-defining-an-azimuthal-equidistant-projection-centered-on-the-midpoint-of-the-swath.-once-the-projection-is-defined-convert-the-lower-left-and-upper-right-corners-of-the-latlon-arrays-to-a-location-in-meters-in-the-new-projection.-lastly-measure-the-distance-between-the-corners-and-divide-by-70-meters-the-nominal-pixel-size-that-we-are-aiming-for.-azimuthal-equidistant-projection-was-chosen-here-based-on-the-following-characteristics-of-this-projection" class="level4">
<h4 class="anchored" data-anchor-id="below-pyproj.proj-is-used-to-perform-a-cartographic-transformation-by-defining-an-azimuthal-equidistant-projection-centered-on-the-midpoint-of-the-swath.-once-the-projection-is-defined-convert-the-lower-left-and-upper-right-corners-of-the-latlon-arrays-to-a-location-in-meters-in-the-new-projection.-lastly-measure-the-distance-between-the-corners-and-divide-by-70-meters-the-nominal-pixel-size-that-we-are-aiming-for.-azimuthal-equidistant-projection-was-chosen-here-based-on-the-following-characteristics-of-this-projection">Below, <code>pyproj.Proj</code> is used to perform a cartographic transformation by defining an Azimuthal Equidistant projection centered on the midpoint of the swath. Once the projection is defined, convert the lower left and upper right corners of the lat/lon arrays to a location (in meters) in the new projection. Lastly, measure the distance between the corners and divide by 70 (meters), the nominal pixel size that we are aiming for. Azimuthal Equidistant projection was chosen here based on the following characteristics of this projection:</h4>
<ul>
<li>Units in meters (necessary for defining 70 m pixels)<br>
</li>
<li>Distances between all points are proportionally correct from center point</li>
<li>Azimuth (direction) are correct from the center point</li>
</ul>
<div id="cell-26" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define AEQD projection centered at swath center</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>epsgConvert <span class="op">=</span> pyproj.Proj(<span class="st">"+proj=aeqd +lat_0=</span><span class="sc">{}</span><span class="st"> +lon_0=</span><span class="sc">{}</span><span class="st">"</span>.<span class="bu">format</span>(midLat, midLon))</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use info from AEQD projection bbox to calculate output cols/rows/pixel size</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>llLon, llLat <span class="op">=</span> epsgConvert(np.<span class="bu">min</span>(lon), np.<span class="bu">min</span>(lat), inverse<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>urLon, urLat <span class="op">=</span> epsgConvert(np.<span class="bu">max</span>(lon), np.<span class="bu">max</span>(lat), inverse<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>areaExtent <span class="op">=</span> (llLon, llLat, urLon, urLat)</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>cols <span class="op">=</span> <span class="bu">int</span>(<span class="bu">round</span>((areaExtent[<span class="dv">2</span>] <span class="op">-</span> areaExtent[<span class="dv">0</span>]) <span class="op">/</span> <span class="dv">70</span>))  <span class="co"># 70 m pixel size</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>rows <span class="op">=</span> <span class="bu">int</span>(<span class="bu">round</span>((areaExtent[<span class="dv">3</span>] <span class="op">-</span> areaExtent[<span class="dv">1</span>]) <span class="op">/</span> <span class="dv">70</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="use-number-of-rows-and-columns-generated-above-from-the-aeqd-projection-to-set-a-representative-number-of-rows-and-columns-in-the-geographic-area-definition-which-will-then-be-translated-to-degrees-below-then-take-the-smaller-of-the-two-pixel-dims-to-determine-output-size-and-ensure-square-pixels." class="level4">
<h4 class="anchored" data-anchor-id="use-number-of-rows-and-columns-generated-above-from-the-aeqd-projection-to-set-a-representative-number-of-rows-and-columns-in-the-geographic-area-definition-which-will-then-be-translated-to-degrees-below-then-take-the-smaller-of-the-two-pixel-dims-to-determine-output-size-and-ensure-square-pixels.">Use number of rows and columns generated above from the AEQD projection to set a representative number of rows and columns in the Geographic area definition, which will then be translated to degrees below, then take the smaller of the two pixel dims to determine output size and ensure square pixels.</h4>
<div id="cell-28" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define Geographic projection</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>epsg, proj, pName <span class="op">=</span> <span class="st">'4326'</span>, <span class="st">'longlat'</span>, <span class="st">'Geographic'</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Define bounding box of swath</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>llLon, llLat, urLon, urLat <span class="op">=</span> np.<span class="bu">min</span>(lon), np.<span class="bu">min</span>(lat), np.<span class="bu">max</span>(lon), np.<span class="bu">max</span>(lat)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>areaExtent <span class="op">=</span> (llLon, llLat, urLon, urLat)</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Create area definition with estimated number of columns and rows</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>projDict <span class="op">=</span> pyproj.CRS(<span class="st">"epsg:4326"</span>)</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>areaDef <span class="op">=</span> geom.AreaDefinition(epsg, pName, proj, projDict, cols, rows, areaExtent)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="below-square-the-pixels-by-setting-the-pixel-size-to-the-smaller-of-the-x-any-y-values-output-by-the-areadefinition-then-use-the-pixel-size-to-recalculate-the-number-of-output-colsrows." class="level4">
<h4 class="anchored" data-anchor-id="below-square-the-pixels-by-setting-the-pixel-size-to-the-smaller-of-the-x-any-y-values-output-by-the-areadefinition-then-use-the-pixel-size-to-recalculate-the-number-of-output-colsrows.">Below, square the pixels by setting the pixel size to the smaller of the x any y values output by the <code>AreaDefinition</code>, then use the pixel size to recalculate the number of output cols/rows.</h4>
<div id="cell-30" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Square pixels and calculate output cols/rows</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>ps <span class="op">=</span> np.<span class="bu">min</span>([areaDef.pixel_size_x, areaDef.pixel_size_y])</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>cols <span class="op">=</span> <span class="bu">int</span>(<span class="bu">round</span>((areaExtent[<span class="dv">2</span>] <span class="op">-</span> areaExtent[<span class="dv">0</span>]) <span class="op">/</span> ps))</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>rows <span class="op">=</span> <span class="bu">int</span>(<span class="bu">round</span>((areaExtent[<span class="dv">3</span>] <span class="op">-</span> areaExtent[<span class="dv">1</span>]) <span class="op">/</span> ps))</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up a new Geographic area definition with the refined cols/rows</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>areaDef <span class="op">=</span> geom.AreaDefinition(epsg, pName, proj, projDict, cols, rows, areaExtent)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="below-use-pyresample-kd_trees-get_neighbour_info-to-create-arrays-with-information-on-the-nearest-neighbor-to-each-grid-point." class="level4">
<h4 class="anchored" data-anchor-id="below-use-pyresample-kd_trees-get_neighbour_info-to-create-arrays-with-information-on-the-nearest-neighbor-to-each-grid-point.">Below, use <code>pyresample kd_tree</code>â€™s <a href="https://pyresample.readthedocs.io/en/latest/swath.html#resampling-from-neighbour-info">get_neighbour_info</a> to create arrays with information on the nearest neighbor to each grid point.</h4>
</section>
<section id="this-is-the-most-computationally-heavy-task-in-the-swath2grid-conversion-and-using-get_neighbour_info-speeds-up-the-process-if-you-plan-to-resample-multiple-sds-within-an-ecostress-product-compute-once-instead-of-for-every-sds." class="level4">
<h4 class="anchored" data-anchor-id="this-is-the-most-computationally-heavy-task-in-the-swath2grid-conversion-and-using-get_neighbour_info-speeds-up-the-process-if-you-plan-to-resample-multiple-sds-within-an-ecostress-product-compute-once-instead-of-for-every-sds.">This is the most computationally heavy task in the swath2grid conversion and using <code>get_neighbour_info</code> speeds up the process if you plan to resample multiple SDS within an ECOSTRESS product (compute once instead of for every SDS).</h4>
<div id="cell-32" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get arrays with information about the nearest neighbor to each grid point </span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>index, outdex, indexArr, distArr <span class="op">=</span> kdt.get_neighbour_info(swathDef, areaDef, <span class="dv">210</span>, neighbours<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="above-the-function-is-comparing-the-swath-and-area-definitions-to-locate-the-nearest-neighbor-neighbours1.-210-is-the-radius_of_influence-or-the-radius-used-to-search-for-the-nearest-neighboring-pixel-in-the-swath-in-meters." class="level4">
<h4 class="anchored" data-anchor-id="above-the-function-is-comparing-the-swath-and-area-definitions-to-locate-the-nearest-neighbor-neighbours1.-210-is-the-radius_of_influence-or-the-radius-used-to-search-for-the-nearest-neighboring-pixel-in-the-swath-in-meters.">Above, the function is comparing the swath and area definitions to locate the nearest neighbor (neighbours=1). 210 is the <code>radius_of_influence</code>, or the radius used to search for the nearest neighboring pixel in the swath (in meters).</h4>
<hr>
</section>
</section>
<section id="c.-read-sds-metadata" class="level2">
<h2 class="anchored" data-anchor-id="c.-read-sds-metadata">3c. Read SDS Metadata</h2>
<section id="list-the-attributes-for-the-etinst-layer-which-can-then-be-used-to-define-the-fill-value-and-scale-factor." class="level4">
<h4 class="anchored" data-anchor-id="list-the-attributes-for-the-etinst-layer-which-can-then-be-used-to-define-the-fill-value-and-scale-factor.">List the attributes for the <code>ETinst</code> layer, which can then be used to define the fill value and scale factor.</h4>
<div id="cell-35" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read in ETinst and print out SDS attributes</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>s <span class="op">=</span> ecoSDS[<span class="dv">0</span>]</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>ecoSD <span class="op">=</span> f[s][()]</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> attr <span class="kw">in</span> f[s].attrs:</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">type</span>(f[s].attrs[attr]) <span class="op">==</span> np.ndarray:</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'</span><span class="sc">{</span>attr<span class="sc">}</span><span class="ss"> = </span><span class="sc">{</span>f[s]<span class="sc">.</span>attrs[attr][<span class="dv">0</span>]<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'</span><span class="sc">{</span>attr<span class="sc">}</span><span class="ss"> = </span><span class="sc">{</span>f[s]<span class="sc">.</span>attrs[attr]<span class="sc">.</span>decode(<span class="st">"utf-8"</span>)<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>_FillValue = nan
add_offset = 0.0
long_name = Instantaneous Latent Heat Flux
scale_factor = 1.0
units = W/m^2
valid_max = 2000.0
valid_min = 0.0</code></pre>
</div>
</div>
</section>
<section id="extract-the-scale-factor-add-offset-and-fill-value-from-the-sds-metadata." class="level4">
<h4 class="anchored" data-anchor-id="extract-the-scale-factor-add-offset-and-fill-value-from-the-sds-metadata.">Extract the scale factor, add offset and fill value from the SDS metadata.</h4>
<div id="cell-37" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>f[s].attrs[<span class="st">'_FillValue'</span>][<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">
<pre><code>np.float32(nan)</code></pre>
</div>
</div>
<div id="cell-38" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read SDS attributes and define fill value, add offset, and scale factor if available</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    fv <span class="op">=</span> <span class="bu">int</span>(f[s].attrs[<span class="st">'_FillValue'</span>])</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">KeyError</span>:</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    fv <span class="op">=</span> <span class="va">None</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">ValueError</span>:</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    fv <span class="op">=</span> f[s].attrs[<span class="st">'_FillValue'</span>][<span class="dv">0</span>]</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>    sf <span class="op">=</span> f[s].attrs[<span class="st">'_Scale'</span>][<span class="dv">0</span>]</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span>:</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>    sf <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>    add_off <span class="op">=</span> f[s].attrs[<span class="st">'_Offset'</span>][<span class="dv">0</span>]</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span>:</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>    add_off <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>    units <span class="op">=</span> f[s].attrs[<span class="st">'units'</span>].decode(<span class="st">"utf-8"</span>)</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span>:</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>    units <span class="op">=</span> <span class="st">'none'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
</section>
<section id="d.-perform-k-d-tree-resampling" class="level2">
<h2 class="anchored" data-anchor-id="d.-perform-k-d-tree-resampling">3d. Perform K-D Tree Resampling</h2>
<section id="remember-that-the-resampling-has-been-split-into-two-steps.-in-section-3b.-arrays-containing-the-nearest-neighbor-to-each-grid-point-were-created.-the-second-step-is-to-use-those-arrays-to-retrieve-a-resampled-result." class="level4">
<h4 class="anchored" data-anchor-id="remember-that-the-resampling-has-been-split-into-two-steps.-in-section-3b.-arrays-containing-the-nearest-neighbor-to-each-grid-point-were-created.-the-second-step-is-to-use-those-arrays-to-retrieve-a-resampled-result.">Remember that the resampling has been split into two steps. In section 3b. arrays containing the nearest neighbor to each grid point were created. The second step is to use those arrays to retrieve a resampled result.</h4>
<div id="cell-40" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform K-D Tree nearest neighbor resampling (swath 2 grid conversion)</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>ETgeo <span class="op">=</span> kdt.get_sample_from_neighbour_info(<span class="st">'nn'</span>, areaDef.shape, ecoSD, index, outdex, indexArr, fill_value<span class="op">=</span><span class="va">None</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="above-resample-the-swath-ecosd-array-using-nearest-neighbor-already-calculated-in-section-3b.-and-defined-above-as-the-index-outdex-and-indexarr-and-also-set-the-fill-value-that-was-defined-in-section-3c." class="level4">
<h4 class="anchored" data-anchor-id="above-resample-the-swath-ecosd-array-using-nearest-neighbor-already-calculated-in-section-3b.-and-defined-above-as-the-index-outdex-and-indexarr-and-also-set-the-fill-value-that-was-defined-in-section-3c.">Above, resample the swath <code>ecoSD</code> array using nearest neighbor (already calculated in section 3b. and defined above as the <code>index</code>, <code>outdex</code>, and <code>indexArr</code>), and also set the fill value that was defined in section 3c.</h4>
</section>
<section id="below-define-the-geotransform-for-the-output-upper-left-x-horizontal-pixel-size-rotation-upper-left-y-rotation-vertical-pixel-size." class="level4">
<h4 class="anchored" data-anchor-id="below-define-the-geotransform-for-the-output-upper-left-x-horizontal-pixel-size-rotation-upper-left-y-rotation-vertical-pixel-size.">Below, define the geotransform for the output (upper left x, horizontal pixel size, rotation, upper left y, rotation, vertical pixel size).</h4>
<div id="cell-42" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the geotransform </span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>gt <span class="op">=</span> [areaDef.area_extent[<span class="dv">0</span>], ps, <span class="dv">0</span>, areaDef.area_extent[<span class="dv">3</span>], <span class="dv">0</span>, <span class="op">-</span>ps]</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>gt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="31">
<pre><code>[np.float64(-121.86703190925778),
 np.float64(0.0006302582963630697),
 0,
 np.float64(39.05327678830593),
 0,
 np.float64(-0.0006302582963630697)]</code></pre>
</div>
</div>
<hr>
</section>
</section>
<section id="e.-basic-image-processing" class="level2">
<h2 class="anchored" data-anchor-id="e.-basic-image-processing">3e. Basic Image Processing</h2>
<section id="apply-the-scale-factor-and-add-offset-and-set-the-fill-value-defined-in-the-previous-section-on-the-resampled-data." class="level4">
<h4 class="anchored" data-anchor-id="apply-the-scale-factor-and-add-offset-and-set-the-fill-value-defined-in-the-previous-section-on-the-resampled-data.">Apply the scale factor and add offset and set the fill value defined in the previous section on the resampled data.</h4>
<div id="cell-44" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>ETgeo <span class="op">=</span> ETgeo <span class="op">*</span> sf <span class="op">+</span> add_off            <span class="co"># Apply Scale Factor and Add Offset</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>ETgeo[ETgeo <span class="op">==</span> fv <span class="op">*</span> sf <span class="op">+</span> add_off] <span class="op">=</span> fv  <span class="co"># Set Fill Value</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="rerun-steps-3c---3e-for-etinstuncertainty." class="level4">
<h4 class="anchored" data-anchor-id="rerun-steps-3c---3e-for-etinstuncertainty.">Rerun steps 3c - 3e for <code>ETinstUncertainty</code>.</h4>
<div id="cell-46" class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>s <span class="op">=</span> ecoSDS[<span class="dv">1</span>]</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>ecoSD <span class="op">=</span> f[s][()]</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>    fv <span class="op">=</span> <span class="bu">int</span>(f[s].attrs[<span class="st">'_FillValue'</span>])</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">KeyError</span>:</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>    fv <span class="op">=</span> <span class="va">None</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">ValueError</span>:</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>    fv <span class="op">=</span> f[s].attrs[<span class="st">'_FillValue'</span>][<span class="dv">0</span>]</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>    sf <span class="op">=</span> f[s].attrs[<span class="st">'_Scale'</span>][<span class="dv">0</span>]</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span>:</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>    sf <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>    add_off <span class="op">=</span> f[s].attrs[<span class="st">'_Offset'</span>][<span class="dv">0</span>]</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span>:</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>    add_off <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>UNgeo <span class="op">=</span> kdt.get_sample_from_neighbour_info(<span class="st">'nn'</span>, areaDef.shape, ecoSD, index, outdex, indexArr, fill_value<span class="op">=</span><span class="va">None</span>)</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>UNgeo <span class="op">=</span> UNgeo <span class="op">*</span> sf <span class="op">+</span> add_off</span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>UNgeo[UNgeo <span class="op">==</span> fv <span class="op">*</span> sf <span class="op">+</span> add_off] <span class="op">=</span> fv</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<h1>
<center>
<ol start="4" type="1">
<li>Exporting Results
</li></ol></center>
</h1>

<hr>
</section>
</section>
<section id="a.-set-up-a-dictionary" class="level2">
<h2 class="anchored" data-anchor-id="a.-set-up-a-dictionary">4a. Set Up a Dictionary</h2>
<section id="in-this-section-create-a-dictionary-containing-each-of-the-arrays-that-will-be-exported-as-geotiffs." class="level4">
<h4 class="anchored" data-anchor-id="in-this-section-create-a-dictionary-containing-each-of-the-arrays-that-will-be-exported-as-geotiffs.">In this section, create a dictionary containing each of the arrays that will be exported as GeoTIFFs.</h4>
<div id="cell-48" class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up dictionary of arrays to export</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>outFiles <span class="op">=</span> {<span class="st">'ETinst'</span>: ETgeo, <span class="st">'ETinstUncertainty'</span>: UNgeo}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
</section>
<section id="b.-define-crs-and-export-as-geotiffs" class="level2">
<h2 class="anchored" data-anchor-id="b.-define-crs-and-export-as-geotiffs">4b. Define CRS and Export as GeoTIFFs</h2>
<section id="now-that-the-data-have-been-imported-and-resampled-into-a-gridded-raster-array-export-the-results-as-geotiffs-using-a-for-loop-in-this-section." class="level4">
<h4 class="anchored" data-anchor-id="now-that-the-data-have-been-imported-and-resampled-into-a-gridded-raster-array-export-the-results-as-geotiffs-using-a-for-loop-in-this-section.">Now that the data have been imported and resampled into a gridded raster array, export the results as GeoTIFFs using a <code>for</code> loop in this section.</h4>
<div id="cell-50" class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>fv <span class="op">=</span> np.nan</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-51" class="cell" data-scrolled="true" data-execution_count="36">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through each item in dictionary created above</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> outFiles:</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Set up output name</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>    outName <span class="op">=</span> join(outDir, <span class="st">'</span><span class="sc">{}</span><span class="st">_</span><span class="sc">{}</span><span class="st">.tif'</span>.<span class="bu">format</span>(ecoName, <span class="bu">file</span>))</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"output file:</span><span class="ch">\n</span><span class="sc">{}</span><span class="ch">\n</span><span class="st">"</span>.<span class="bu">format</span>(outName))</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get driver, specify dimensions, define and set output geotransform</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>    height, width <span class="op">=</span> outFiles[<span class="bu">file</span>].shape</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>    driv <span class="op">=</span> gdal.GetDriverByName(<span class="st">'GTiff'</span>)</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>    dataType <span class="op">=</span> gdal_array.NumericTypeCodeToGDALTypeCode(outFiles[<span class="bu">file</span>].dtype)</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>    d <span class="op">=</span> driv.Create(outName, width, height, <span class="dv">1</span>, dataType)</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>    d.SetGeoTransform(gt)</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create and set output projection, write output array data</span></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define target SRS</span></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>    srs <span class="op">=</span> osr.SpatialReference()</span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>    srs.ImportFromEPSG(<span class="bu">int</span>(epsg))</span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>    d.SetProjection(srs.ExportToWkt())</span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>    srs.ExportToWkt()</span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Write array to band</span></span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>    band <span class="op">=</span> d.GetRasterBand(<span class="dv">1</span>)</span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>    band.WriteArray(outFiles[<span class="bu">file</span>])</span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define fill value if it exists, if not, set to mask fill value</span></span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> fv <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="kw">and</span> fv <span class="op">!=</span> <span class="st">'NaN'</span>:</span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a>        band.SetNoDataValue(fv)</span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a>            band.SetNoDataValue(outFiles[<span class="bu">file</span>].fill_value)</span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span>:</span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a>            <span class="cf">pass</span></span>
<span id="cb37-34"><a href="#cb37-34" aria-hidden="true" tabindex="-1"></a>    band.FlushCache()</span>
<span id="cb37-35"><a href="#cb37-35" aria-hidden="true" tabindex="-1"></a>    d, band <span class="op">=</span> <span class="va">None</span>, <span class="va">None</span>    </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>output file:
..\output\ECOSTRESS_L3_ET_PT-JPL_00468_007_20180805T220314_0601_04_ETinst.tif

output file:
..\output\ECOSTRESS_L3_ET_PT-JPL_00468_007_20180805T220314_0601_04_ETinstUncertainty.tif
</code></pre>
</div>
</div>
<hr>
<h1>
<center>
<ol start="5" type="1">
<li>Combining ECOSTRESS and AmeriFlux Tower Data
</li></ol></center>
</h1>

<hr>
</section>
</section>
<section id="a.-loading-tables-with-pandas" class="level2">
<h2 class="anchored" data-anchor-id="a.-loading-tables-with-pandas">5a. Loading Tables with Pandas</h2>
<section id="in-this-section-begin-by-highlighting-how-to-open-a-csv-file-using-the-pandas-package." class="level4">
<h4 class="anchored" data-anchor-id="in-this-section-begin-by-highlighting-how-to-open-a-csv-file-using-the-pandas-package.">In this section, begin by highlighting how to open a csv file using the <code>pandas</code> package.</h4>
<blockquote class="blockquote">
<p>The AmeriFlux tower data was provided by Mike Goulden for the AmeriFlux US-CZ3 tower. The csv includes half-hourly observations of Latent Heat (W/m<span class="math inline">\(^{2}\)</span>) for the same day as the ECOSTRESS observation.</p>
</blockquote>
<div id="cell-53" class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import csv file with AmeriFlux data and drop NaNs</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>towerData <span class="op">=</span> pd.read_csv(<span class="st">'tower_data.csv'</span>)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>towerData <span class="op">=</span> towerData.dropna()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="next-use-the-parser-package-and-a-lambda-function-to-go-through-each-time-stamp-and-reformat-to-date-and-time-objects." class="level4">
<h4 class="anchored" data-anchor-id="next-use-the-parser-package-and-a-lambda-function-to-go-through-each-time-stamp-and-reformat-to-date-and-time-objects.">Next, use the <code>parser</code> package and a lambda function to go through each time stamp and reformat to date and time objects.</h4>
<div id="cell-55" class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a lambda function to use the parser packgage to convert each time stamp to a datetime object</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>towerData[<span class="st">"Date/Time"</span>] <span class="op">=</span> towerData[<span class="st">"Time"</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: parser.parse(x))</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>towerData[<span class="st">"Time"</span>] <span class="op">=</span> towerData[<span class="st">"Date/Time"</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: datetime.time(x.hour, x.minute))</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>towerData <span class="op">=</span> towerData[[<span class="st">"Date/Time"</span>, <span class="st">"Time"</span>, <span class="st">"LE"</span>]]</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>towerData</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="38">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Date/Time</th>
<th data-quarto-table-cell-role="th">Time</th>
<th data-quarto-table-cell-role="th">LE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>2018-08-05 09:30:00</td>
<td>09:30:00</td>
<td>18.027752</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2018-08-05 10:00:00</td>
<td>10:00:00</td>
<td>68.495970</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5</td>
<td>2018-08-05 10:30:00</td>
<td>10:30:00</td>
<td>89.050031</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>2018-08-05 11:00:00</td>
<td>11:00:00</td>
<td>154.564199</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9</td>
<td>2018-08-05 11:30:00</td>
<td>11:30:00</td>
<td>118.685090</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>2018-08-05 12:00:00</td>
<td>12:00:00</td>
<td>107.071870</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">13</td>
<td>2018-08-05 12:30:00</td>
<td>12:30:00</td>
<td>189.551249</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>2018-08-05 13:00:00</td>
<td>13:00:00</td>
<td>129.985112</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">19</td>
<td>2018-08-05 14:00:00</td>
<td>14:00:00</td>
<td>139.651745</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">21</td>
<td>2018-08-05 14:30:00</td>
<td>14:30:00</td>
<td>155.416112</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">23</td>
<td>2018-08-05 15:00:00</td>
<td>15:00:00</td>
<td>124.511936</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">25</td>
<td>2018-08-05 15:30:00</td>
<td>15:30:00</td>
<td>106.666146</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">27</td>
<td>2018-08-05 16:00:00</td>
<td>16:00:00</td>
<td>176.321112</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">29</td>
<td>2018-08-05 16:30:00</td>
<td>16:30:00</td>
<td>203.363058</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">31</td>
<td>2018-08-05 17:00:00</td>
<td>17:00:00</td>
<td>166.714904</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">33</td>
<td>2018-08-05 17:30:00</td>
<td>17:30:00</td>
<td>124.236028</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">35</td>
<td>2018-08-05 18:00:00</td>
<td>18:00:00</td>
<td>96.232450</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">37</td>
<td>2018-08-05 18:30:00</td>
<td>18:30:00</td>
<td>133.121365</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">39</td>
<td>2018-08-05 19:00:00</td>
<td>19:00:00</td>
<td>44.660266</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">41</td>
<td>2018-08-05 19:30:00</td>
<td>19:30:00</td>
<td>11.618052</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">43</td>
<td>2018-08-05 20:00:00</td>
<td>20:00:00</td>
<td>44.201492</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<hr>
</section>
</section>
<section id="b.-locate-ecostress-pixel-from-latlon-coordinates" class="level2">
<h2 class="anchored" data-anchor-id="b.-locate-ecostress-pixel-from-latlon-coordinates">5b. Locate ECOSTRESS Pixel from Lat/Lon Coordinates</h2>
<section id="calculate-the-gridded-pixel-nearest-to-the-tower-location." class="level4">
<h4 class="anchored" data-anchor-id="calculate-the-gridded-pixel-nearest-to-the-tower-location.">Calculate the gridded pixel nearest to the tower location.</h4>
<div id="cell-57" class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>towerLat, towerLon <span class="op">=</span> <span class="fl">37.0674</span>, <span class="op">-</span><span class="fl">119.1951</span>  <span class="co"># AmeriFlux US-CZ3 tower location</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate tower lat/lon distance from upper left corner, then divide by pixel size to find x,y pixel location</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>Tcol <span class="op">=</span> <span class="bu">int</span>(<span class="bu">round</span>((towerLon <span class="op">-</span> gt[<span class="dv">0</span>]) <span class="op">/</span> gt[<span class="dv">1</span>]))</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>Trow <span class="op">=</span> <span class="bu">int</span>(<span class="bu">round</span>((towerLat <span class="op">-</span> gt[<span class="dv">3</span>]) <span class="op">/</span> gt[<span class="dv">5</span>]))</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Print ET at the tower location</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>ETgeo[Trow, Tcol]                               </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="39">
<pre><code>np.float64(172.5819549560547)</code></pre>
</div>
</div>
<hr>
<h1>
<center>
<ol start="6" type="1">
<li>Visualizing Data
</li></ol></center>
</h1>

<hr>
</section>
</section>
<section id="a.-create-a-colormap" class="level2">
<h2 class="anchored" data-anchor-id="a.-create-a-colormap">6a. Create a Colormap</h2>
<section id="before-plotting-the-et-data-set-up-an-evapotranspiration-color-map-using-linearsegmentedcolormap-from-the-matplotlib-package." class="level4">
<h4 class="anchored" data-anchor-id="before-plotting-the-et-data-set-up-an-evapotranspiration-color-map-using-linearsegmentedcolormap-from-the-matplotlib-package.">Before plotting the ET data, set up an Evapotranspiration color map using <code>LinearSegmentedColormap</code> from the <code>matplotlib</code> package.</h4>
<div id="cell-59" class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a colormap for the ET data</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>ETcolors <span class="op">=</span> [<span class="st">"#f6e8c3"</span>, <span class="st">"#d8b365"</span>, <span class="st">"#99974a"</span>, <span class="st">"#53792d"</span>, <span class="st">"#6bdfd2"</span>, <span class="st">"#1839c5"</span>]</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>ETcmap <span class="op">=</span> LinearSegmentedColormap.from_list(<span class="st">"ET"</span>, ETcolors)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
</section>
<section id="b.-calculate-local-overpass-time" class="level2">
<h2 class="anchored" data-anchor-id="b.-calculate-local-overpass-time">6b. Calculate Local Overpass Time</h2>
<section id="ecostress-observation-times-are-reported-in-universal-time-coordinated-utc.-below-grab-the-observation-time-from-the-filename-and-convert-to-local-time-using-the-longitude-location-of-the-tower." class="level4">
<h4 class="anchored" data-anchor-id="ecostress-observation-times-are-reported-in-universal-time-coordinated-utc.-below-grab-the-observation-time-from-the-filename-and-convert-to-local-time-using-the-longitude-location-of-the-tower.">ECOSTRESS observation times are reported in Universal Time Coordinated (UTC). Below, grab the observation time from the filename and convert to local time using the longitude location of the tower.</h4>
<div id="cell-61" class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Grab UTC time of observation from file name</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>ecoTime <span class="op">=</span> ecoName.split(<span class="st">'_'</span>)[<span class="op">-</span><span class="dv">3</span>]</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>ecoTime</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="41">
<pre><code>'20180805T220314'</code></pre>
</div>
</div>
</section>
<section id="next-convert-utc-observation-time-to-local-overpass-time." class="level4">
<h4 class="anchored" data-anchor-id="next-convert-utc-observation-time-to-local-overpass-time.">Next, convert UTC observation time to local overpass time.</h4>
<div id="cell-63" class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>observationTime <span class="op">=</span> parser.parse(ecoTime)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>solarOverpass <span class="op">=</span> observationTime <span class="op">+</span> datetime.timedelta(hours<span class="op">=</span>(np.radians(towerLon) <span class="op">/</span> np.pi <span class="op">*</span> <span class="dv">12</span>))</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>overpass <span class="op">=</span> datetime.time(solarOverpass.hour, solarOverpass.minute)</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>date <span class="op">=</span> observationTime.strftime(<span class="st">'%Y-%m-</span><span class="sc">%d</span><span class="st">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
</section>
<section id="c.-plot-et-data" class="level2">
<h2 class="anchored" data-anchor-id="c.-plot-et-data">6c. Plot ET Data</h2>
<section id="in-this-section-begin-by-highlighting-the-functionality-of-the-matplotlib-plotting-package.-first-make-a-plot-of-the-entire-gridded-et-output.-next-zoom-in-on-the-tower-location-and-add-some-additional-parameters-to-the-plot.-finally-export-the-completed-plot-to-an-image-file." class="level4">
<h4 class="anchored" data-anchor-id="in-this-section-begin-by-highlighting-the-functionality-of-the-matplotlib-plotting-package.-first-make-a-plot-of-the-entire-gridded-et-output.-next-zoom-in-on-the-tower-location-and-add-some-additional-parameters-to-the-plot.-finally-export-the-completed-plot-to-an-image-file.">In this section, begin by highlighting the functionality of the <code>matplotlib</code> plotting package. First, make a plot of the entire gridded ET output. Next, zoom in on the tower location and add some additional parameters to the plot. Finally, export the completed plot to an image file.</h4>
<div id="cell-65" class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>title <span class="op">=</span> <span class="st">'ECO3ETPTJPL Evapotranspiration'</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>SDSname <span class="op">=</span> ecoSDS[<span class="dv">0</span>].split(<span class="st">"/"</span>)[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="fl">9.7</span>,<span class="fl">7.6</span>))                                                       <span class="co"># Set the figure size (x,y)</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>fig.suptitle(<span class="ss">f'</span><span class="sc">{</span>title<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>ecoSDS[<span class="dv">0</span>]<span class="sc">.</span>split(<span class="st">"/"</span>)[<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">)</span><span class="ch">\n</span><span class="sc">{</span>date<span class="sc">}</span><span class="ss"> at </span><span class="sc">{</span>overpass<span class="sc">}</span><span class="ss">'</span>, fontsize<span class="op">=</span><span class="dv">22</span>)  <span class="co"># Add title for the plots</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="st">'off'</span>)                                                                           <span class="co"># Remove axes from plot</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>im <span class="op">=</span> plt.imshow(ETgeo, cmap<span class="op">=</span>ETcmap)<span class="op">;</span>                                                        <span class="co"># Plot array using colormap</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>plt.scatter(Tcol, Trow, color<span class="op">=</span><span class="st">"black"</span>, marker<span class="op">=</span><span class="st">'x'</span>)                                        <span class="co"># Plot tower location</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a colormap legend</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>plt.colorbar(im, orientation<span class="op">=</span><span class="st">'horizontal'</span>, fraction<span class="op">=</span><span class="fl">0.05</span>, pad<span class="op">=</span><span class="fl">0.004</span>, label<span class="op">=</span><span class="ss">f'ET (</span><span class="sc">{</span>units<span class="sc">}</span><span class="ss">)'</span>, shrink<span class="op">=</span><span class="fl">0.6</span>).outline.set_visible(<span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ECOSTRESS_Tutorial_files/figure-html/cell-33-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<hr>
</section>
</section>
<section id="d.-exporting-an-image" class="level2">
<h2 class="anchored" data-anchor-id="d.-exporting-an-image">6d. Exporting an Image</h2>
<section id="zoom-in-to-get-a-closer-look-at-the-region-surrounding-the-ameriflux-tower-by-creating-a-subset." class="level4">
<h4 class="anchored" data-anchor-id="zoom-in-to-get-a-closer-look-at-the-region-surrounding-the-ameriflux-tower-by-creating-a-subset.">Zoom in to get a closer look at the region surrounding the AmeriFlux tower by creating a subset.</h4>
<div id="cell-67" class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set a Radius and calculate subset region from flux tower location (row, col)</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>radius <span class="op">=</span> <span class="dv">1700</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>ETsubset <span class="op">=</span> ETgeo[(Trow <span class="op">-</span> radius):(Trow <span class="op">+</span> radius <span class="op">+</span> <span class="dv">1</span>), (Tcol <span class="op">-</span> radius):(Tcol <span class="op">+</span> radius <span class="op">+</span> <span class="dv">1</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="make-another-plot-this-time-zoomed-in-to-the-tower-location.-export-the-plot-as-a-.png-file." class="level4">
<h4 class="anchored" data-anchor-id="make-another-plot-this-time-zoomed-in-to-the-tower-location.-export-the-plot-as-a-.png-file.">Make another plot, this time zoomed in to the tower location. Export the plot as a .png file.</h4>
<div id="cell-69" class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">14</span>,<span class="dv">12</span>))                                                 <span class="co"># Set the figure size (x,y)</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>fig.suptitle(<span class="ss">f'</span><span class="sc">{</span>title<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>SDSname<span class="sc">}</span><span class="ss">)</span><span class="ch">\n</span><span class="sc">{</span>date<span class="sc">}</span><span class="ss"> at </span><span class="sc">{</span>overpass<span class="sc">}</span><span class="ss">'</span>, fontsize<span class="op">=</span><span class="dv">26</span>)           <span class="co"># Add title for the plots</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="st">'off'</span>)                                                                   <span class="co"># Remove axes from plot</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>im <span class="op">=</span> plt.imshow(ETsubset, cmap<span class="op">=</span>ETcmap)<span class="op">;</span>                                             <span class="co"># Plot array using colormap</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>plt.scatter(ETsubset.shape[<span class="dv">0</span>]<span class="op">/</span><span class="dv">2</span>, ETsubset.shape[<span class="dv">1</span>]<span class="op">/</span><span class="dv">2</span>, color<span class="op">=</span><span class="st">"black"</span>, marker<span class="op">=</span><span class="st">'x'</span>)  <span class="co"># Tower is in middle of subset</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a colormap legend</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>plt.colorbar(im, orientation<span class="op">=</span><span class="st">'horizontal'</span>, fraction<span class="op">=</span><span class="fl">0.05</span>, pad<span class="op">=</span><span class="fl">0.004</span>, label<span class="op">=</span><span class="ss">f'ET (</span><span class="sc">{</span>units<span class="sc">}</span><span class="ss">)'</span>, shrink<span class="op">=</span><span class="fl">0.6</span>).outline.set_visible(<span class="va">True</span>)</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up file name and export to png file</span></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>figure_filename <span class="op">=</span> join(outDir, <span class="st">"</span><span class="sc">{}</span><span class="st">_</span><span class="sc">{}</span><span class="st">.png"</span>.<span class="bu">format</span>(ecoName, SDSname))</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"figure filename: </span><span class="sc">{}</span><span class="st">"</span>.<span class="bu">format</span>(figure_filename))</span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>fig.savefig(figure_filename, dpi<span class="op">=</span><span class="dv">300</span>)</span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>figure filename: ..\output\ECOSTRESS_L3_ET_PT-JPL_00468_007_20180805T220314_0601_04_ETinst.png</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ECOSTRESS_Tutorial_files/figure-html/cell-35-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<hr>
<h1>
<center>
<ol start="7" type="1">
<li>Comparing Observations
</li></ol></center>
</h1>

<hr>
</section>
</section>
<section id="a.-calculate-distribution-of-ecostress-data" class="level2">
<h2 class="anchored" data-anchor-id="a.-calculate-distribution-of-ecostress-data">7a. Calculate Distribution of ECOSTRESS Data</h2>
<section id="first-collect-a-3x3-grid-centered-on-the-flux-tower-pixel-as-a-subset-to-calculate-statistics-on." class="level4">
<h4 class="anchored" data-anchor-id="first-collect-a-3x3-grid-centered-on-the-flux-tower-pixel-as-a-subset-to-calculate-statistics-on.">First, collect a 3x3 grid centered on the flux tower pixel as a subset to calculate statistics on.</h4>
<div id="cell-71" class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset data to 3x3 grid surrounding flux tower for both layers</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>ETfootprint <span class="op">=</span> ETgeo[(Trow <span class="op">-</span> <span class="dv">1</span>):(Trow <span class="op">+</span> <span class="dv">2</span>), (Tcol <span class="op">-</span> <span class="dv">1</span>):(Tcol <span class="op">+</span> <span class="dv">2</span>)] </span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>UNfootprint <span class="op">=</span> UNgeo[(Trow <span class="op">-</span> <span class="dv">1</span>):(Trow <span class="op">+</span> <span class="dv">2</span>), (Tcol <span class="op">-</span> <span class="dv">1</span>):(Tcol <span class="op">+</span> <span class="dv">2</span>)] </span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ETfootprint)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[161.3531036376953 161.25172424316406 145.38726806640625]
 [156.7587432861328 172.5819549560547 172.5819549560547]
 [140.9962158203125 140.9962158203125 185.904052734375]]</code></pre>
</div>
</div>
</section>
<section id="in-case-the-3x3-grid-contains-missing-values-use-np.nanmedian-to-ignoring-missing-values-and-calculate-the-measure-of-central-tendency." class="level4">
<h4 class="anchored" data-anchor-id="in-case-the-3x3-grid-contains-missing-values-use-np.nanmedian-to-ignoring-missing-values-and-calculate-the-measure-of-central-tendency.">In case the 3x3 grid contains missing values, use <code>np.nanmedian</code> to ignoring missing values and calculate the measure of central tendency.</h4>
<div id="cell-73" class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>ETmedian <span class="op">=</span> np.nanmedian(ETfootprint)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>UNmedian <span class="op">=</span> np.nanmedian(UNfootprint)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Median ET: </span><span class="sc">{</span>ETmedian<span class="sc">:0.3f}</span><span class="ss"> </span><span class="ch">\n</span><span class="ss">Uncertainty: </span><span class="sc">{</span>UNmedian<span class="sc">:0.3f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Median ET: 161.252 
Uncertainty: 95.294</code></pre>
</div>
</div>
</section>
<section id="next-generate-a-probability-density-function-for-the-3x3-grid-of-et-values." class="level4">
<h4 class="anchored" data-anchor-id="next-generate-a-probability-density-function-for-the-3x3-grid-of-et-values.">Next, generate a probability density function for the 3x3 grid of ET values.</h4>
<div id="cell-75" class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>pd.DataFrame({title: ETfootprint.flatten()}).plot.kde()                                   <span class="co"># Pandas Kernel Density Estimate</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f'Probability Density of </span><span class="sc">{</span>SDSname<span class="sc">}</span><span class="ss"> Surrounding US-CZ3</span><span class="ch">\n</span><span class="sc">{</span>date<span class="sc">}</span><span class="ss"> at </span><span class="sc">{</span>overpass<span class="sc">}</span><span class="ss">'</span>)<span class="op">;</span>  <span class="co"># Title</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="ss">f'</span><span class="sc">{</span>SDSname<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>units<span class="sc">}</span><span class="ss">)'</span>)<span class="op">;</span>                                                       <span class="co"># X-axis label</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ECOSTRESS_Tutorial_files/figure-html/cell-38-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<hr>
</section>
</section>
<section id="b.-visualize-ground-observations" class="level2">
<h2 class="anchored" data-anchor-id="b.-visualize-ground-observations">7b. Visualize Ground Observations</h2>
<section id="next-examine-the-series-of-eddy-covariance-observations-from-the-ameriflux-us-cz3-dataset." class="level4">
<h4 class="anchored" data-anchor-id="next-examine-the-series-of-eddy-covariance-observations-from-the-ameriflux-us-cz3-dataset.">Next, examine the series of eddy covariance observations from the AmeriFlux US-CZ3 dataset.</h4>
<div id="cell-77" class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">7</span>))                                                                      <span class="co"># Set fig size (x,y)</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> fig.add_subplot(<span class="dv">111</span>)                                                                             <span class="co"># Create a subplot</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>ax.plot(towerData[<span class="st">'Date/Time'</span>], towerData.LE, <span class="st">'k'</span>, lw<span class="op">=</span><span class="fl">2.5</span>, color<span class="op">=</span><span class="st">'black'</span>)                                     <span class="co"># Plot as a black line</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="ss">f'Time Series of Eddy Covariance Data at Site US-CZ3'</span>, fontsize<span class="op">=</span><span class="dv">20</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)<span class="op">;</span>  <span class="co"># Set Title</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Latent Heat (W/m^2)'</span>, fontsize<span class="op">=</span><span class="dv">18</span>)<span class="op">;</span>                                                    <span class="co"># Y-axis label</span></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="ss">f'Time of Day (</span><span class="sc">{</span>date<span class="sc">}</span><span class="ss">)'</span>, fontsize<span class="op">=</span><span class="dv">18</span>)<span class="op">;</span>                                                  <span class="co"># X-axis label</span></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>ax.set_xticks(towerData[<span class="st">'Date/Time'</span>])<span class="op">;</span>                                                              <span class="co"># Set the x ticks</span></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>ax.set_xticklabels(towerData[<span class="st">'Time'</span>], rotation<span class="op">=</span><span class="dv">45</span>,fontsize<span class="op">=</span><span class="dv">12</span>)<span class="op">;</span>                                          <span class="co"># Set x tick labels</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ECOSTRESS_Tutorial_files/figure-html/cell-39-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="above-we-can-see-the-daily-range-in-latent-heat-as-captured-by-the-eddy-covariance-observations-on-the-flux-tower." class="level4">
<h4 class="anchored" data-anchor-id="above-we-can-see-the-daily-range-in-latent-heat-as-captured-by-the-eddy-covariance-observations-on-the-flux-tower.">Above, we can see the daily range in Latent Heat as captured by the eddy covariance observations on the flux tower.</h4>
<hr>
</section>
</section>
<section id="c.-combine-ecostress-and-ground-observations" class="level2">
<h2 class="anchored" data-anchor-id="c.-combine-ecostress-and-ground-observations">7c. Combine ECOSTRESS and Ground Observations</h2>
<section id="finally-compare-the-ecostress-evapotranspiration-and-uncertainty-with-the-time-series-of-observations-from-the-flux-tower." class="level4">
<h4 class="anchored" data-anchor-id="finally-compare-the-ecostress-evapotranspiration-and-uncertainty-with-the-time-series-of-observations-from-the-flux-tower.">Finally, compare the ECOSTRESS Evapotranspiration and uncertainty with the time series of observations from the flux tower.</h4>
<div id="cell-80" class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the figure size, create a subplot</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(<span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">7</span>))</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> fig.add_subplot(<span class="dv">111</span>)</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the flux tower observatisons followed by the ecostress median ET and median uncertainty</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>ax.plot(towerData[<span class="st">'Date/Time'</span>], towerData.LE, <span class="st">'k'</span>, lw<span class="op">=</span><span class="fl">2.5</span>, color<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>ax.plot(solarOverpass, ETmedian, <span class="st">'bo'</span>, ms<span class="op">=</span><span class="dv">10</span>, color<span class="op">=</span><span class="st">'darkgreen'</span>)</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>ax.errorbar(solarOverpass, ETmedian, yerr<span class="op">=</span>UNmedian, lw<span class="op">=</span><span class="fl">2.0</span>, c<span class="op">=</span><span class="st">'lightgreen'</span>, fmt<span class="op">=</span><span class="st">'o'</span>, capsize<span class="op">=</span><span class="dv">3</span>, capthick<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Set x/y axes and labels</span></span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="ss">f'Time of Day (</span><span class="sc">{</span>date<span class="sc">}</span><span class="ss">)'</span>, fontsize<span class="op">=</span><span class="dv">18</span>)<span class="op">;</span></span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>ax.set_xticks(towerData[<span class="st">'Date/Time'</span>])<span class="op">;</span></span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>ax.set_xticklabels(towerData.Time, rotation<span class="op">=</span><span class="dv">45</span>,fontsize<span class="op">=</span><span class="dv">12</span>)<span class="op">;</span></span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"Latent Heat Flux (Wm2)"</span>, fontsize<span class="op">=</span><span class="dv">16</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a title and export figure as png file</span></span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="ss">f"Time Series of Eddy Covariance Data at Site US-CZ3</span><span class="ch">\n</span><span class="ss"> vs. </span><span class="sc">{</span>title<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>SDSname<span class="sc">}</span><span class="ss">)"</span>, fontsize<span class="op">=</span><span class="dv">22</span>)</span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>figure_filename <span class="op">=</span> join(outDir, <span class="st">"</span><span class="sc">{}</span><span class="st">_</span><span class="sc">{}</span><span class="st">_vs_fluxtower.png"</span>.<span class="bu">format</span>(ecoName, SDSname))</span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"figure filename: </span><span class="sc">{}</span><span class="st">"</span>.<span class="bu">format</span>(figure_filename))</span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a>fig.savefig(figure_filename, bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>figure filename: ..\output\ECOSTRESS_L3_ET_PT-JPL_00468_007_20180805T220314_0601_04_ETinst_vs_fluxtower.png</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ECOSTRESS_Tutorial_files/figure-html/cell-40-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<hr>
</section>
</section>
<section id="citations" class="level2">
<h2 class="anchored" data-anchor-id="citations">Citations</h2>
<ul>
<li><p>Hook, S., Fisher, J. (2019). ECOSTRESS Evapotranspiration PT-JPL Daily L3 Global 70 m V001 [Data set]. NASA EOSDIS Land Processes DAAC. Accessed 2021-03-11 from https://doi.org/10.5067/ECOSTRESS/ECO3ETPTJPL.001.</p></li>
<li><p>Goulden, M., (2018). AmeriFlux US-CZ3 Sierra Critical Zone, Sierra Transect, Sierran Mixed Conifer, P301, <a href="http://dx.doi.org/10.17190/AMF/1419512">doi:10.17190/AMF/1419512</a>.</p></li>
<li><p>Krehbiel, C., and Halverson, G.H., (2019). Working with ECOSTRESS Evapotranspiration Data [Jupyter Notebook]. Retrieved from https://git.earthdata.nasa.gov/projects/LPDUR/repos/tutorial-ecostress/browse</p></li>
</ul>
</section>
<section id="contact-info" class="level2">
<h2 class="anchored" data-anchor-id="contact-info">Contact Info:</h2>
<p>Material written by Cole Krehbiel<sup>1</sup> and Gregory Halverson<sup>2</sup><br>
Email: LPDAAC@usgs.gov<br>
Voice: +1-866-573-3222<br>
Organization: Land Processes Distributed Active Archive Center (LP DAAC)&lt; Website: <a href="https://lpdaac.usgs.gov/" class="uri">https://lpdaac.usgs.gov/</a></p>
<p><sup>1</sup>Innovate! Inc., contractor to the U.S. Geological Survey, Earth Resources Observation and Science (EROS) Center, Sioux Falls, South Dakota, 57198-001, USA. Work performed under USGS contract G15PD00467 for LP DAAC<sup>3</sup>.<br>
<sup>2</sup>Jet Propulsion Laboratory, California Institute of Technology, Pasadena, CA, USA.</p>
<p><sup>3</sup>LP DAAC Work performed under NASA contract NNG14HH33I.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "î§‹";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/nasa\.github\.io\/ECOSTRESS-Data-Resources\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>ECOSTRESS Data Resources</p>
</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>